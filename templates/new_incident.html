<!-- templates/new_incident.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Incident</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/new_incident.css') }}">
    <!-- Bootstrap CSS + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
{% if 'user' in session %}
<nav class="modern-navbar d-flex align-items-center justify-content-between px-4">
  <a class="nav-link left-link" href="{{ url_for('dashboard') }}">Dashboard</a>
  <div class="navbar-title text-center flex-grow-1">Incident Response Manager</div>
  <div class="dropdown">
    <button class="btn user-button dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person-circle me-1"></i> {{ session['user'] }}
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
      <li>
        <a class="dropdown-item" href="{{ url_for('logout') }}">
          <i class="bi bi-box-arrow-right me-2"></i> Logout
        </a>
      </li>
    </ul>
  </div>
</nav>
{% endif %}

  <div class="dashboard-container">
    <h1>New Incident</h1>
    <form method="post" action="{{ url_for('new_incident') }}">
  <div class="form-group">
    <label for="incident_class">Select Incident Class:</label>
    <select id="incident_class" name="incident_class" onchange="updateIncidentTypes()" required>
  <option value="" disabled selected>Select a class</option>
  {% for class_name in incident_class.keys() %}
    <option value="{{ class_name }}">{{ class_name }}</option>
  {% endfor %}
</select>

  </div>

  <div class="form-group">
    <label for="incident_type">Select Incident Type:</label>
    <select id="incident_type" name="incident_type" required>
  <option value="" disabled selected>Select a type</option>
</select>

  </div>

  <button type="submit" class="button">Start Incident</button>
</form>

  </div>
</body>
<script>
  const incidentClasses = {{ incident_class | tojson }};

  function updateIncidentTypes() {
    const classSelect = document.getElementById('incident_class');
    const typeSelect = document.getElementById('incident_type');

    // Verifica se uma classe foi escolhida e aplica/remover classe visual
    if (classSelect.value !== '') {
      classSelect.classList.add('choose_class');
    } else {
      classSelect.classList.remove('choose_class');
    }

    // Limpa e reseta o dropdown de tipo
    typeSelect.innerHTML = '';
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.text = 'Select a type';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    typeSelect.appendChild(defaultOption);

    if (incidentClasses[classSelect.value]) {
      incidentClasses[classSelect.value].forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.text = type;
        typeSelect.appendChild(option);
      });
    }

    // Remove qualquer highlight anterior
    typeSelect.classList.remove('choose_type');
  }

  // Adiciona evento de verificação no tipo de incidente
  document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('incident_type').addEventListener('change', function () {
    if (this.value !== '') {
      this.classList.add('choose_type');
    } else {
      this.classList.remove('choose_type');
    }
  });
});
</script>

</html>

